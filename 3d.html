<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Calculatrice 3D - CalcPro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background-color: #121212;
      color: white;
      font-family: Arial, sans-serif;
      margin: 0;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      color: #00ffcc;
      margin: 15px 0;
      text-align: center;
    }

    #coords {
      color: #00ffcc;
      margin: 10px;
      font-size: 14px;
    }

    .toolbar {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .toolbar button {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      background: #2563eb;
      color: white;
      font-size: 14px;
      cursor: pointer;
      transition: 0.2s;
    }

    .toolbar button:hover {
      transform: scale(1.05);
    }

    footer {
      margin-top: 5px;
      text-align: center;
      font-size: 14px;
      color: #aaa;
    }

    canvas {
      border-radius: 12px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

<h1>ðŸ§­ Calculatrice 3D - CalcPro</h1>
<div class="toolbar">
  <button id="addPointBtn">Ajouter Point</button>
  <button id="clearBtn">Effacer</button>
</div>
<div id="coords">CoordonnÃ©es : x=0, y=0, z=0</div>
<div id="container" style="width: 100%; height: 500px;"></div>
<footer>DÃ©veloppeur: <strong>Lebbar Yahya</strong></footer>

<!-- Three.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/OrbitControls.js"></script>

<script>
  // === Scene, Camera, Renderer ===
  const container = document.getElementById('container');
  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x1e1e1e);

  const camera = new THREE.PerspectiveCamera(75, container.clientWidth/container.clientHeight, 0.1, 1000);
  camera.position.set(5,5,5);

  const renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(container.clientWidth, container.clientHeight);
  container.appendChild(renderer.domElement);

  // === Controls ===
  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;

  // === Axes Helper ===
  const axesHelper = new THREE.AxesHelper(5);
  scene.add(axesHelper);

  // === Grid Helper ===
  const gridHelper = new THREE.GridHelper(20, 20);
  scene.add(gridHelper);

  // === Points Array ===
  const points = [];

  const coords = document.getElementById("coords");

  // === Functions ===
  function addPoint(x, y, z) {
    const geometry = new THREE.SphereGeometry(0.2, 16, 16);
    const material = new THREE.MeshBasicMaterial({color: 0xffeb3b});
    const sphere = new THREE.Mesh(geometry, material);
    sphere.position.set(x, y, z);
    scene.add(sphere);
    points.push(sphere);
  }

  function clearScene() {
    points.forEach(p => scene.remove(p));
    points.length = 0;
  }

  // === Mouse Click to add point ===
  let addPointMode = false;
  document.getElementById("addPointBtn").onclick = () => {
    addPointMode = !addPointMode;
    document.getElementById("addPointBtn").style.background = addPointMode ? "#22c55e" : "#2563eb";
  };

  document.getElementById("clearBtn").onclick = clearScene;

  // Convert mouse click to 3D point
  renderer.domElement.addEventListener('click', function(event){
    if(!addPointMode) return;

    const rect = renderer.domElement.getBoundingClientRect();
    const mouse = new THREE.Vector2(
      ((event.clientX - rect.left)/rect.width)*2 -1,
      -((event.clientY - rect.top)/rect.height)*2 +1
    );

    const raycaster = new THREE.Raycaster();
    raycaster.setFromCamera(mouse, camera);
    const intersects = raycaster.intersectObject(gridHelper, true);

    // Add point at click on grid plane
    const point = intersects[0] ? intersects[0].point : new THREE.Vector3(0,0,0);
    addPoint(point.x, point.y, point.z);
    coords.innerText = `CoordonnÃ©es : x=${point.x.toFixed(2)}, y=${point.y.toFixed(2)}, z=${point.z.toFixed(2)}`;
  });

  // === Animation Loop ===
  function animate(){
    requestAnimationFrame(animate);
    controls.update();
    renderer.render(scene, camera);
  }

  animate();

  // === Responsive ===
  window.addEventListener('resize', ()=>{
    camera.aspect = container.clientWidth/container.clientHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(container.clientWidth, container.clientHeight);
  });
</script>

</body>
</html>
